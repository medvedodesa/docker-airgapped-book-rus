# /etc/modprobe.d/blacklist-security.conf
# Kernel module blacklist for Docker hosts in air-gapped environments
#
# Apply with: dracut -f (RHEL/CentOS) or update-initramfs -u (Ubuntu/Debian)
# Reboot required

# ============================================
# WIRELESS MODULES
# ============================================
# Not needed in datacenter environments

blacklist iwlwifi
blacklist iwlmvm
blacklist iwldvm
blacklist cfg80211
blacklist mac80211

# ============================================
# BLUETOOTH
# ============================================
# Not needed in server environments

blacklist bluetooth
blacklist btusb
blacklist btrtl
blacklist btintel

# ============================================
# UNCOMMON FILESYSTEMS
# ============================================
# Reduce attack surface by blocking rarely used filesystems

# Compressed ROM filesystem
blacklist cramfs

# Veritas filesystem
blacklist freevxfs

# Journaling Flash File System v2
blacklist jffs2

# Apple HFS/HFS+
blacklist hfs
blacklist hfsplus

# Universal Disk Format
blacklist udf

# SquashFS (unless using for containers)
# blacklist squashfs

# FAT filesystems (unless needed)
# blacklist vfat
# blacklist msdos

# ============================================
# USB STORAGE
# ============================================
# Uncomment to disable USB storage devices
# CAUTION: This prevents USB drives from mounting

# blacklist usb-storage
# blacklist uas

# ============================================
# FIREWIRE
# ============================================
# Firewire allows Direct Memory Access (DMA) attacks

blacklist firewire-core
blacklist firewire-ohci
blacklist firewire-sbp2

# ============================================
# THUNDERBOLT
# ============================================
# Similar to Firewire, can allow DMA attacks

blacklist thunderbolt

# ============================================
# UNCOMMON NETWORK PROTOCOLS
# ============================================
# Block rarely used protocols that may have vulnerabilities

# Datagram Congestion Control Protocol
blacklist dccp

# Stream Control Transmission Protocol
blacklist sctp

# Reliable Datagram Sockets
blacklist rds

# Transparent Inter-Process Communication
blacklist tipc

# ============================================
# VIDEO/GRAPHICS (Server Environment)
# ============================================
# Uncomment if running headless servers

# blacklist nouveau    # Nvidia
# blacklist radeon     # AMD
# blacklist i915       # Intel

# ============================================
# SOUND
# ============================================
# Not needed on servers

blacklist snd
blacklist soundcore
blacklist snd_pcm
blacklist snd_timer

# ============================================
# PCMCIA
# ============================================
# Legacy laptop card slots

blacklist pcmcia
blacklist yenta_socket

# ============================================
# INFRARED
# ============================================

blacklist irda
blacklist irnet

# ============================================
# PARALLEL PORT
# ============================================

blacklist parport
blacklist parport_pc

# ============================================
# FLOPPY DISK
# ============================================

blacklist floppy

# ============================================
# CD-ROM (Uncomment if not needed)
# ============================================

# blacklist sr_mod
# blacklist cdrom

# ============================================
# NOTES
# ============================================

# 1. USB Storage:
#    - Blacklisting usb-storage prevents USB drives
#    - May interfere with firmware updates
#    - Consider policy-based USB control instead

# 2. Wireless:
#    - Safe to blacklist in datacenter
#    - No wireless needed for servers

# 3. Bluetooth:
#    - Safe to blacklist on servers
#    - No legitimate server use case

# 4. Firewire/Thunderbolt:
#    - Known DMA attack vectors
#    - Highly recommended to blacklist

# 5. Uncommon Filesystems:
#    - Reduces kernel attack surface
#    - Unlikely to be needed

# 6. Uncommon Protocols:
#    - DCCP, SCTP, RDS, TIPC rarely used
#    - Known vulnerabilities exist
#    - Safe to block

# ============================================
# APPLICATION
# ============================================

# RHEL/CentOS/Rocky:
#   dracut -f
#   reboot

# Ubuntu/Debian:
#   update-initramfs -u
#   reboot

# ============================================
# VERIFICATION
# ============================================

# After reboot, verify modules not loaded:
#   lsmod | grep -E "iwl|bluetooth|firewire|dccp|sctp"
#   Should return nothing

# Check if module is blacklisted:
#   modprobe -n -v iwlwifi
#   Should show "blacklist" message

# ============================================
# EXCEPTIONS
# ============================================

# If you need a blacklisted module, you can:
# 1. Remove from this file
# 2. Rebuild initramfs
# 3. Reboot

# Or temporarily override (until next boot):
#   modprobe --force modulename

# ============================================
# SECURITY IMPACT
# ============================================

# Blacklisting modules:
# - Reduces kernel attack surface
# - Prevents driver vulnerabilities
# - Blocks DMA attack vectors (Firewire, Thunderbolt)
# - Prevents USB-based attacks (if usb-storage blocked)

# ============================================
# COMPLIANCE
# ============================================

# Satisfies:
# - CIS Benchmark recommendations
# - NIST 800-53 CM-7 (Least Functionality)
# - PCI DSS Requirement 2.2 (Disable unnecessary services)
